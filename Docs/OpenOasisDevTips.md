<img src="../Rsrcs/Logo/logo_doc.png" alt="">

---------------------------------------------------------------------------------

# 绿洲开发小贴士

*OpenOasis Development Tips*

绿洲项目旨在用于学术以及教学用途，因此在设计各种算法和方案的实现细节时，编码的清晰度  
是重中之重。尽管如此，它的所有数值和算法在很多方面都与  
面向工业的 CFD 代码中使用的数值和算法相似，并尽可能提供详尽的文档资料。

+ [Tip1-关于模型开发阶段的划分和文档要求](#tip1-关于模型开发阶段的划分和文档要求)
+ [Tip2-关于项目的发布流程](#tip2-关于关于项目的发布流程)
+ [Tip3-关于项目的编码风格](#tip3-关于关于项目的编码风格)
+ [Tip4-关于项目的组织结构](#tip4-关于关于项目的组织结构)

+ [Tipx-模型组件设计的要求](#tipx-模型组件设计的要求)

---------------------------------------------------------------------------------

## Tip1: 关于模型开发阶段的划分和文档要求

每个人都有各自不同的工作研究背景、关注方向和技术优势，可以在不同阶段参与到项目开发中。    
如果我们的开发流程更加清晰，相信可以帮助吸引更多感兴趣的伙伴来组队：  

+ 标识当前的 `开发阶段`，方便了解开发进度；
+ 提供完善的 `技术文档`，方便了解当前开发方向、技术路线和升级需求。

*------ 模型的开发阶段 ------*

作为一个尚未经充分实践的建议，可以考虑将模型的开发过程划分为以下几个阶段：

**1st: 第一阶段**，
提出模型想法，说明开发目的或意义，提供一些基础开发资料、方向或思路；

通常来说，`1st`仍处于前期讨论阶段，可以在项目仓库、知乎问题、课题小组或者其他平台提出，  
作为一个 `issue`、一个 `提问`、一个 `报告`、一个 `动态` 发布。根据以往的经历，  
**组成一个方向一致的团队，是高效解决问题的充分条件**。

**2nd: 第二阶段**，
设计模型算法，解释理论依据，提供算法详细设计（计算链路闭环）；

这个阶段可能主要聚焦在如何使想法落地，怎么样来设计一个完整的计算逻辑或计算链路？  
这个阶段可能还需要初步的原型实现，敲代码和推公式交织进行。

**3rd: 第三阶段**，
实施开发方案，完成代码接口、结构定义，完成代码开发和单元测试；

进入 `3rd` 阶段通常表明模型的算法已经基本稳定，开始设计具体的代码实现方案。  
一般的建议是，着手编码前先确定模块集成接口，设计模块结构，  
同时，在开发过程中遵循一套代码规范和格式化方案，  
并及时完成单元测试、集成测试。

**4th: 第四阶段**，
完成评估方案，测试模型准确性和稳定性，测试模型参数敏感性以及适用性。

**种种困扰下，种种努力下，在这里我们终于实现了自己的算法！**  

绿洲作为一个实验项目，开发质量依然需要得到保障 — **详细的测试和评估报告**。  
在可靠的单元测试的基础上，进一步的进行相对充分的模型用例测试 
(需要覆盖可预见的常见场景和部分极端场景)，
测试模块的稳定性、适用性，分析模块的参数敏感性，进一步地测试模块的准确性及性能表现。

除此之外，可能还包括：

**5th: 维护阶段**，
修复模块bug、升级加强模块功能、重构模块等。
  

*------ 模型的技术文档 ------*

为了提高模型和项目的可靠性、可用性和可维护性，一个模型组件文档需要包含：

+ `算法详细设计`，说明算法原理和前提假设，提供完整的计算过程以及涉及的变量定义；
+ `开发接口说明`，说明组件接口，包括接口参数、接口功能和可能的异常等；
+ `测试评估报告`，提供各类测试结果分析报告；
+ `模型操作手册`，说明模型的用户端输入输出格式，演示常见场景下的组件使用。

聚焦于模块的可靠性，`测试评估报告`中应该包括模型与现实的一致性、参数及前提假设的影响、  
参数真值以及其分布的影响分析，提供模型校核报告、参数敏感性评估报告、  
网格相关性评估报告，数值算法稳定性评估报告，
模型性能评估报告。

[<i class="fa fa-home"></i>](#绿洲开发小贴士)

---------------------------------------------------------------------------------

## Tip2: 关于项目的发布流程

项目同时发布在GitHub、Gitee；采用 Git 作为协作开发和版本控制工具；采用Github flow开发模式；
版本号采用major.minor.patch格式。  
暂定每年春分和秋分发布大版本更新（如果有），并提前一个月冻结合并请求、执行回归测试。

[<i class="fa fa-home"></i>](#绿洲开发小贴士)

---------------------------------------------------------------------------------

## Tip3: 关于项目的编码风格
  
绿洲项目中主要参考 [华为编程风格](https://www.bookstack.cn/read/openharmony-1.0-zh-cn/contribute-OpenHarmony-cpp-coding-style-guide.md)，具体包括：

1. 类命名规则    
    - 类名应该为名词及名词短语，尽可能使用完整的词。
    - 使用 `Pascal` 规则（每个单词开头的字母大写）。
    - 不要使用类前缀（不要使用下划线字符 `_`）。
    - 在适当的地方使用复合单词命名派生类。派生类名称的第二个部分应当是基类的名称。

2. 接口命名规则
    - 接口名称应该为名词及名词短语或者描述其行为的形容词，尽可能使用完整的词。
    - 使用 `Pascal` 规则。
    - 使用字符 `I` 为前缀，并紧跟一个大写字母（接口名的第一个字母大写）。

3. 枚举命名规则
    - 对于 `Enum` 类型和值名称使用 `Pascal` 大小写。
    - 少用缩写。
    - 不要在 `Enum` 类型名称上使用 "Enum" 后缀。
    - 对大多数 `Enum` 类型使用单数名称，但是对作为位域的 `Enum` 类型使用复数名称。

4. 变量命名
    - 在简单的循环语句中计数器变量使用 i, j, k, l, m, n。
    - 使用 `Camel` 命名规则（除了第一个单词外的其他单词的开头字母大写）。       

5. 方法命名
    - 使用 `Pascal` 规则。
    - 对方法名采用一致的动词/宾语或宾语/动词顺序。
    - 不要在方法中重复类的名称。例如，如果某个类已命名为 Book，
    则不要将某个方法称为 Book.CloseBook，
    而可以将方法命名为 Book.Close。

6. 属性命名
    - 名称应该为名词及名词短语。
    - 使用 `Pascal` 规则。
    - 对于 `bool` 型属性或者变量使用 'Is（is）' 作为前缀，不要使用 "Flag" 后缀，
    例如应该使用IsDeleted，而不要使用DeleteFlag。

7. 集合命名
    - 名称应该为名词及名词短语。
    - 使用 `Pascal` 规则。
    - 名称后面追加 “Collection”。

8. 自定义的异常以Exception结尾

9. 类成员变量使用 ‘m’ 前缀从而与局部变量作区分

10. 在类的顶部声明所有的成员变量，静态变量声明在最前面

[<i class="fa fa-home"></i>](#绿洲开发小贴士)

---------------------------------------------------------------------------------

## Tip4: 关于项目的组织结构

```
OpenOasis Project Structure:

+-- /
|   +-- setup.py              : python 打包脚本
|   +-- launcher.cpp          : 模块功能加载入口
|   +-- Cores/                : 数值算法模型集
|   |   +-- CommImpl/         : 接口的通用实现(算法开发sdk和接口开发sdk)
|   |   +-- Inc/              : 接口约定
|   |   +-- SystFluids/       : 流体流动模型集
|   |   +-- SystHeats/        : 热量流动模型集
|   |   +-- Utils/            : 通用功能模块
|   |   +-- tests/            : 测试集
|   |   +-- wrappers/         : python 模型封装
|   +-- DataAnalysis/         : 数据分析、处理和可视化工具包
|   +-- Dists/                : 项目编译发布包
|   +-- Docs/                 : 项目文档
|   +-- OasisAgents/          : 深度学习与强化学习解决方案
|   +-- Rsrcs/                : 相关资源
|   +-- Tools/                : 第三方工具箱
```

[<i class="fa fa-home"></i>](#绿洲开发小贴士)

---------------------------------------------------------------------------------

## Tipx: 模型组件设计的要求

本节主要收集关于模型组件设计的一些想法。

1. 关于模型建模质量检查和模型参数率定

数值模型的对象搭建需要综合许多不同来源和体系的数据， 模型的使用需要经过率定和验证。
为了能降低对使用者的专业水平的依赖，  
需提供一套自动的、智能的模型质量检查和参数率定系统。

比如对于一维河道水动力模型，可以采用 “箱型图” 来分析
断面内高程分布、断面间距分布、河道底坡分布情况，并生成模型质量统计图表。

对于模型的率定和验证，一般应该存在两个流程：
首先，根据模型提供的性能评估指标（如水量平衡百分比、不收敛百分比、不收敛对象数量），  
以此为优化和率定目标，初步调整模型参数；
然后，如果项目存在实测数据，以模拟和实测数据的差异最小化为目标进一步优化模型参数。

这里需要注意的是，对于实测数据，应该先分析其数据的可靠性和合理性。

[<i class="fa fa-home"></i>](#绿洲开发小贴士)

---------------------------------------------------------------------------------

