<img src="../Rsrcs/Logo/logo_doc.png" alt="">

---------------------------------------------------------------------------------

# 绿洲开发小贴士

*OpenOasis Development Tips*

绿洲项目旨在用于学术以及教学用途，因此在设计各种算法和方案的实现细节时，编码的清晰度是重中之重。  
尽管如此，它的所有数值和算法在很多方面都与面向工业的 CFD 代码中使用的数值和算法相似，并鼓励详尽的文档说明。

+ [Tip1-关于模型开发过程和文档：一个待完善的开发建议](#tip1-关于模型开发阶段的划分和文档要求)
+ [Tip2-关于项目的发布流程](#tip2-关于关于项目的发布流程)
+ [Tip3-关于项目的编码风格](#tip3-关于关于项目的编码风格)
+ [Tip4-关于项目的组织结构](#tip4-关于关于项目的组织结构)

+ [Tipx-临时说明](#tipx-临时说明)

---------------------------------------------------------------------------------

## Tip1: 关于模型开发阶段的划分和文档要求

一个模型的开发过程可能会经历以下几个阶段：

**1st: 第一阶段**

提出模型想法，说明开发目的或意义，提供一些基础开发资料、方向或思路；通常来说，`1st`仍处于前期讨论阶段，可以在项目仓库、知乎问题、课题小组或者其他平台提出，  
作为一个 `issue`、一个 `提问`、一个 `报告`、一个 `动态` 发布。

**2nd: 第二阶段**

设计模型算法，解释理论依据，提供算法详细设计（计算链路闭环）。

这个阶段可能主要聚焦在如何使想法落地，怎么样来设计一个完整的计算逻辑或计算链路？  
这个阶段可能还需要初步的原型实现，敲代码和推公式交织进行。

**3rd: 第三阶段**

实施开发方案，定义模型数据和接口，完成模块开发和单元测试。

进入 `3rd` 阶段通常表明模型的算法已经基本稳定，开始工程项目开发。一般的建议是，着手编码前梳理功能模块关系，确定模块集成接口，设计数据结构；同时，在开发过程中遵循一套代码规范和格式化方案，并及时完成单元测试、集成测试，注意代码覆盖度。

**4th: 第四阶段**

通过模型评估方案，测试模型准确性和稳定性，测试参数敏感性。
  
在可靠的单元测试基础上，进一步地进行相对充分的模型用例测试(需要覆盖可预见的常见场景和部分极端场景)，测试模块的稳定性、适用性，分析模块的参数敏感性，进一步地测试模块的准确性及性能表现。

除此之外，可能还包括：

**5th: 维护阶段**

修复模块bug、升级模块功能、重构模块等后期维护。


**模型文档**

为了提高模型和项目的可靠性和可维护性，一个模型组件的文档建议包含：

+ `算法详细设计`，说明算法原理和前提假设，提供完整的计算过程以及涉及的变量定义；
+ `开发接口说明`，说明组件接口，包括接口参数、接口功能和可能的异常等；
+ `测试评估报告`，提供各类测试结果分析报告；
+ `模型操作手册`，说明模型的用户端输入输出格式，演示常见场景下的组件使用。

聚焦于模块的可靠性，`测试评估报告`中应该包括模型与现实的一致性、参数及前提假设的影响、参数真值以及其分布的影响分析，提供模型校核报告、参数敏感性评估报告、网格相关性评估报告，数值算法稳定性评估报告，模型性能评估报告。

[<i class="fa fa-home"></i>](#绿洲开发小贴士)

---------------------------------------------------------------------------------

## Tip2: 关于项目的发布流程

项目暂定发布在GitHub；采用 Git 作为协作开发和版本控制工具；采用Github flow开发模式；版本号采用major.minor.patch格式。  
项目暂定每年秋分发布大版本更新（如果有），并提前一个月冻结合并请求、执行回归测试。

[<i class="fa fa-home"></i>](#绿洲开发小贴士)

---------------------------------------------------------------------------------

## Tip3: 关于项目的编码风格
  
绿洲项目中主要参考 [华为编程风格](https://www.bookstack.cn/read/openharmony-1.0-zh-cn/contribute-OpenHarmony-cpp-coding-style-guide.md)，差异在于：

1. 成员变量用前置 `m` 标识，不适用后缀 `_`。

2. 文件名可以使用大驼峰命名。

在开发过程中培养代码工程素养，对代码“有讲究”，有助于我们开发更可靠和好维护的模型模块：

+ 统一的命名逻辑、良好的封装隔离、清晰的数据流，能帮助控制代码的复杂度。
+ 美观、符合直觉、直白的代码。
+ 好的代码读起来有一种韵律感，能让人一天都很开心。

对于单个概念，定义好其内涵外延；对于多个概念，梳理好其层次关系。映射到代码上，就是不同类的职责清晰划分。

但需要声明，不同的阶段对讲究程度要求是不一样的，如何抉择呢？这里可以引入一个参考度量：**生命周期**。
生命周期越长的代码，一定要写的越干净；临时使用代码，比如原型、脚本，就可以不讲究一些。反过来，也正是干净的代码才能成就超长的生命周期。

[<i class="fa fa-home"></i>](#绿洲开发小贴士)

---------------------------------------------------------------------------------

## Tip4: 关于绿洲的项目架构

```
OpenOasis Project Structure:

+-- /
|   +-- setup.py              : python 打包脚本
|   +-- launcher.cpp          : 模块功能加载入口
|   +-- Cores/                : 数值算法模型集
|   |   +-- CommImpl/         : 接口的通用实现(算法开发sdk和集成开发sdk)
|   |   +-- Inc/              : 接口约定
|   |   +-- SystFluids/       : 流体流动模型集
|   |   +-- SystHeats/        : 热量流动模型集
|   |   +-- Utils/            : 通用功能模块
|   |   +-- tests/            : 测试集
|   |   +-- wrappers/         : python 接口封装
|   +-- DataAnalysis/         : 数据分析、处理和可视化工具包
|   +-- Dists/                : 项目编译发布包
|   +-- Docs/                 : 项目文档
|   +-- OasisAgents/          : 深度学习与强化学习解决方案
|   +-- Rsrcs/                : 相关资源
|   +-- Tools/                : 第三方工具箱
```

[<i class="fa fa-home"></i>](#绿洲开发小贴士)

---------------------------------------------------------------------------------

## Tipx: 临时说明


---------------------------------------------------------------------------------